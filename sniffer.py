from machine import Pin, I2C, ADC
from time import sleep

from fusb302 import FUSB302
from pdstacc import PDStacc

########################
#
# Hardware Stuff
#
########################

replay = True

i2c = I2C(sda=Pin(18), scl=Pin(19), id=1, freq=400000)
print(i2c.scan())
int_p = Pin(20, Pin.IN, Pin.PULL_UP)

fusb = FUSB302(i2c, int_p=int_p)

stacc = PDStacc(fusb)

########################
#
# Packet capture code
#
########################

packets = []
# my usb-c dock with usb3 and hdmi i think?
packets1 = [[192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 65, 0, 187, 108, 187, 168, 224, 66, 16, 44, 177, 4, 18, 171, 173, 31, 42, 224, 97, 1, 143, 120, 56, 74, 224, 99, 3, 33, 123, 0, 150, 224, 65, 2, 151, 13, 181, 70], [224, 102, 5, 81, 42, 20, 2, 224, 65, 4, 162, 168, 214, 175], [192, 79, 22, 1, 128, 0, 255, 80, 232, 231, 212, 192, 79, 22, 1, 128, 0, 255, 80, 232, 231, 212, 192, 79, 22, 1, 128, 0, 255, 80, 232, 231, 212, 192, 79, 22, 1, 128, 0, 255, 80, 232, 231, 212], [192, 79, 24, 1, 128, 0, 255, 49, 86, 215, 107, 192, 79, 24, 1, 128, 0, 255, 49, 86, 215, 107, 192, 79, 24, 1, 128, 0, 255, 49, 86, 215, 107, 192, 79, 24, 1, 128, 0, 255, 49, 86, 215, 107], [192, 79, 26, 1, 128, 0, 255, 81, 5, 23, 17, 192, 79, 26, 1, 128, 0, 255, 81, 5, 23, 17, 192, 79, 26, 1, 128, 0, 255, 81, 5, 23, 17, 192, 79, 26, 1, 128, 0, 255, 81, 5, 23, 17], [192, 79, 28, 1, 128, 0, 255, 241, 240, 87, 158, 192, 79, 28, 1, 128, 0, 255, 241, 240, 87, 158, 192, 79, 28, 1, 128, 0, 255, 241, 240, 87, 158, 192, 79, 28, 1, 128, 0, 255, 241, 240, 87, 158], [192, 79, 30, 1, 128, 0, 255, 145, 163, 151, 228, 192, 79, 30, 1, 128, 0, 255, 145, 163, 151, 228, 192, 79, 30, 1, 128, 0, 255, 145, 163, 151, 228, 192, 79, 30, 1, 128, 0, 255, 145, 163, 151, 228], [192, 79, 16, 1, 128, 0, 255, 240, 29, 167, 91, 192, 79, 16, 1, 128, 0, 255, 240, 29, 167, 91, 192, 79, 16, 1, 128, 0, 255, 240, 29, 167, 91, 192, 79, 16, 1, 128, 0, 255, 240, 29, 167, 91], [192, 79, 18, 1, 128, 0, 255, 144, 78, 103, 33, 192, 79, 18, 1, 128, 0, 255, 144, 78, 103, 33, 192, 79, 18, 1, 128, 0, 255, 144, 78, 103, 33, 192, 79, 18, 1, 128, 0, 255, 144, 78, 103, 33], [192, 79, 20, 1, 128, 0, 255, 48, 187, 39, 174, 192, 79, 20, 1, 128, 0, 255, 48, 187, 39, 174, 192, 79, 20, 1, 128, 0, 255, 48, 187, 39, 174, 192, 79, 20, 1, 128, 0, 255, 48, 187, 39, 174], [192, 79, 22, 1, 128, 0, 255, 80, 232, 231, 212, 192, 79, 22, 1, 128, 0, 255, 80, 232, 231, 212, 192, 79, 22, 1, 128, 0, 255, 80, 232, 231, 212, 192, 79, 22, 1, 128, 0, 255, 80, 232, 231, 212], [192, 79, 24, 1, 128, 0, 255, 49, 86, 215, 107, 192, 79, 24, 1, 128, 0, 255, 49, 86, 215, 107, 192, 79, 24, 1, 128, 0, 255, 49, 86, 215, 107, 192, 79, 24, 1, 128, 0, 255, 49, 86, 215, 107], [192, 79, 26, 1, 128, 0, 255, 81, 5, 23, 17, 192, 79, 26, 1, 128, 0, 255, 81, 5, 23, 17, 192, 79, 26, 1, 128, 0, 255, 81, 5, 23, 17, 192, 79, 26, 1, 128, 0, 255, 81, 5, 23, 17], [192, 79, 28, 1, 128, 0, 255, 241, 240, 87, 158, 192, 79, 28, 1, 128, 0, 255, 241, 240, 87, 158, 192, 79, 28, 1, 128, 0, 255, 241, 240, 87, 158, 192, 79, 28, 1, 128, 0, 255, 241, 240, 87, 158], [192, 79, 30, 1, 128, 0, 255, 145, 163, 151, 228, 192, 79, 30, 1, 128, 0, 255, 145, 163, 151, 228, 192, 79, 30, 1, 128, 0, 255, 145, 163, 151, 228, 192, 79, 30, 1, 128, 0, 255, 145, 163, 151, 228], [192, 79, 16, 1, 128, 0, 255, 240, 29, 167, 91, 192, 79, 16, 1, 128, 0, 255, 240, 29, 167, 91, 192, 79, 16, 1, 128, 0, 255, 240, 29, 167, 91, 192, 79, 16, 1, 128, 0, 255, 240, 29, 167, 91], [192, 79, 18, 1, 128, 0, 255, 144, 78, 103, 33, 192, 79, 18, 1, 128, 0, 255, 144, 78, 103, 33, 192, 79, 18, 1, 128, 0, 255, 144, 78, 103, 33, 192, 79, 18, 1, 128, 0, 255, 144, 78, 103, 33], [192, 79, 20, 1, 128, 0, 255, 48, 187, 39, 174, 192, 79, 20, 1, 128, 0, 255, 48, 187, 39, 174, 192, 79, 20, 1, 128, 0, 255, 48, 187, 39, 174, 192, 79, 20, 1, 128, 0, 255, 48, 187, 39, 174], [192, 79, 22, 1, 128, 0, 255, 80, 232, 231, 212, 192, 79, 22, 1, 128, 0, 255, 80, 232, 231, 212, 192, 79, 22, 1, 128, 0, 255, 80, 232, 231, 212, 192, 79, 22, 1, 128, 0, 255, 80, 232, 231, 212], [224, 111, 23, 1, 128, 0, 255, 214, 196, 43, 238, 224, 65, 6, 142, 201, 216, 65, 224, 79, 82, 65, 128, 0, 255, 164, 37, 0, 44, 0, 0, 0, 0, 1, 0, 0, 0, 11, 0, 0, 17, 49, 174, 102, 75, 224, 97, 3, 163, 25, 54, 164, 224, 111, 25, 2, 128, 0, 255, 89, 213, 174, 67, 224, 65, 8, 137, 228, 96, 166, 224, 79, 52, 66, 128, 0, 255, 164, 37, 1, 255, 0, 0, 0, 0, 166, 70, 26, 81, 224, 97, 5, 150, 188, 85, 77, 224, 111, 27, 3, 128, 1, 255, 29, 208, 201, 152, 224, 65, 10, 165, 133, 110, 72, 224, 79, 38, 67, 128, 1, 255, 5, 12, 0, 0, 241, 253, 40, 109, 224, 97, 7, 186, 221, 91, 163, 224, 111, 29, 4, 129, 1, 255, 51, 119, 156, 139, 224, 65, 12, 144, 32, 13, 161, 224, 79, 24, 68, 129, 1, 255, 72, 165, 196, 223, 224, 97, 9, 189, 240, 227, 68, 224, 111, 47, 16, 129, 1, 255, 1, 0, 0, 0, 216, 217, 112, 117, 224, 65, 14, 188, 65, 3, 79, 224, 79, 42, 80, 129, 1, 255, 26, 0, 0, 0, 52, 141, 63, 222, 224, 97, 11, 145, 145, 237, 170, 224, 111, 33, 17, 129, 1, 255, 6, 8, 0, 0, 213, 107, 220, 226, 224, 65, 0, 187, 108, 187, 168], [224, 79, 28, 81, 129, 1, 255, 37, 164, 131, 77, 224, 97, 13, 164, 52, 142, 67]]
packets2 = [[224, 33, 1, 138, 55, 65, 186, 224, 163, 3, 111, 172, 250, 93, 224, 166, 5, 31, 253, 238, 201, 0, 224, 0, 33, 1, 1, 138, 55, 0, 65, 186]]
# framework card
packets3 = [[192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 1, 0, 190, 35, 194, 88, 224, 130, 16, 41, 164, 128, 18, 249, 127, 43, 73, 224, 97, 1, 143, 120, 56, 74, 224, 163, 3, 111, 172, 250, 93, 224, 1, 2, 146, 66, 204, 182], [224, 166, 5, 31, 253, 238, 201, 224, 1, 4, 167, 231, 175, 95], [192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253], [192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66], [192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56], [192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183], [192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205], [192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114], [192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253], [192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66], [192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56], [192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183], [192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205], [192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114], [192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253], [224, 175, 23, 1, 160, 0, 255, 130, 156, 142, 199, 224, 1, 6, 139, 134, 161, 177, 224, 143, 82, 65, 160, 0, 255, 172, 50, 0, 108, 0, 0, 0, 0, 0, 0, 3, 0, 24, 0, 0, 0, 47, 142, 158, 155, 224, 97, 3, 163, 25, 54, 164, 224, 175, 25, 2, 160, 0, 255, 13, 141, 11, 106, 224, 1, 8, 140, 171, 25, 86, 224, 143, 36, 66, 160, 0, 255, 0, 0, 1, 255, 235, 230, 247, 249, 224, 97, 5, 150, 188, 85, 77, 224, 175, 27, 3, 160, 1, 255, 73, 136, 108, 177, 224, 1, 10, 160, 202, 23, 184, 224, 143, 38, 67, 160, 1, 255, 5, 16, 0, 0, 216, 144, 22, 207, 224, 97, 7, 186, 221, 91, 163, 224, 175, 29, 4, 161, 1, 255, 103, 47, 57, 162, 224, 1, 12, 149, 111, 116, 81, 224, 143, 24, 68, 161, 1, 255, 28, 253, 97, 246, 224, 175, 47, 16, 161, 1, 255, 1, 0, 0, 0, 229, 238, 114, 194, 224, 1, 14, 185, 14, 122, 191]]
packets4 = [[192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 1, 0, 190, 35, 194, 88, 224, 130, 16, 41, 164, 128, 18, 249, 127, 43, 73, 224, 97, 1, 143, 120, 56, 74, 224, 163, 3, 111, 172, 250, 93, 224, 1, 2, 146, 66, 204, 182], [224, 166, 5, 31, 253, 238, 201, 224, 1, 4, 167, 231, 175, 95], [192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253], [192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66], [192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56], [192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183], [192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205], [192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114], [192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253], [192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66], [192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56], [192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183], [192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205], [192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114], [192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253], [224, 175, 23, 1, 160, 0, 255, 130, 156, 142, 199, 224, 1, 6, 139, 134, 161, 177, 224, 143, 82, 65, 160, 0, 255, 172, 50, 0, 108, 0, 0, 0, 0, 0, 0, 3, 0, 24, 0, 0, 0, 47, 142, 158, 155, 224, 97, 3, 163, 25, 54, 164, 224, 175, 25, 2, 160, 0, 255, 13, 141, 11, 106, 224, 1, 8, 140, 171, 25, 86, 224, 143, 36, 66, 160, 0, 255, 0, 0, 1, 255, 235, 230, 247, 249], [224, 97, 5, 150, 188, 85, 77, 224, 175, 27, 3, 160, 1, 255, 73, 136, 108, 177, 224, 1, 10, 160, 202, 23, 184, 224, 143, 38, 67, 160, 1, 255, 5, 16, 0, 0, 216, 144, 22, 207, 224, 97, 7, 186, 221, 91, 163, 224, 175, 29, 4, 161, 1, 255, 103, 47, 57, 162, 224, 1, 12, 149, 111, 116, 81, 224, 143, 24, 68, 161, 1, 255, 28, 253, 97, 246, 224, 1, 14, 185, 14, 122, 191, 224, 97, 11, 145, 145, 237, 170], [192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 1, 0, 190, 35, 194, 88, 224, 130, 16, 41, 164, 128, 18, 249, 127, 43, 73, 224, 97, 1, 143, 120, 56, 74, 224, 163, 3, 111, 172, 250, 93, 224, 1, 2, 146, 66, 204, 182], [224, 166, 5, 31, 253, 238, 201, 224, 1, 4, 167, 231, 175, 95], [192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253], [192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66], [192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56], [192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183], [192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205], [192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114], [192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253], [192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66], [192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56], [192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183], [192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205], [192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114], [192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253], [224, 175, 23, 1, 160, 0, 255, 130, 156, 142, 199, 224, 1, 6, 139, 134, 161, 177, 224, 143, 82, 65, 160, 0, 255, 172, 50, 0, 108, 0, 0, 0, 0, 0, 0, 3, 0, 24, 0, 0, 0, 47, 142, 158, 155, 224, 97, 3, 163, 25, 54, 164, 224, 175, 25, 2, 160, 0, 255, 13, 141, 11, 106, 224, 1, 8, 140, 171, 25, 86, 224, 143, 36, 66, 160, 0, 255, 0, 0, 1, 255, 235, 230, 247, 249, 224, 97, 5, 150, 188, 85, 77, 224, 175, 27, 3, 160, 1, 255, 73, 136, 108, 177, 224, 1, 10, 160, 202, 23, 184, 224, 143, 38, 67, 160, 1, 255, 5, 16, 0, 0, 216, 144, 22, 207, 224, 97, 7, 186, 221, 91, 163, 224, 175, 29, 4, 161, 1, 255, 103, 47, 57, 162, 224, 1, 12, 149, 111, 116, 81, 224, 143, 24, 68, 161, 1, 255, 28, 253, 97, 246, 224, 175, 47, 16, 161, 1, 255, 1, 0, 0, 0, 229, 238, 114, 194, 224, 1, 14, 185, 14, 122, 191]]
# larger usb hub connected through separate cable
packets5 = [[192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 65, 1, 45, 92, 188, 223, 192, 143, 81, 65, 160, 0, 255, 34, 5, 96, 28, 67, 9, 0, 0, 144, 1, 23, 10, 67, 38, 10, 17, 144, 140, 83, 42, 192, 65, 0, 187, 108, 187, 168, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 65, 0, 187, 108, 187, 168, 224, 130, 16, 44, 177, 4, 19, 137, 131, 240, 76, 224, 97, 1, 143, 120, 56, 74, 224, 163, 3, 111, 172, 250, 93, 224, 65, 2, 151, 13, 181, 70], [224, 166, 5, 31, 253, 238, 201, 224, 65, 4, 162, 168, 214, 175], [224, 175, 23, 1, 160, 0, 255, 130, 156, 142, 199, 224, 65, 6, 142, 201, 216, 65, 224, 143, 82, 65, 160, 0, 255, 92, 29, 128, 109, 70, 66, 15, 0, 1, 7, 2, 113, 217, 0, 0, 17, 78, 127, 126, 152, 224, 97, 3, 163, 25, 54, 164, 224, 175, 25, 2, 160, 0, 255, 13, 141, 11, 106, 224, 65, 8, 137, 228, 96, 166, 224, 143, 36, 66, 160, 0, 255, 0, 0, 1, 255, 235, 230, 247, 249, 224, 97, 5, 150, 188, 85, 77], [192, 143, 18, 2, 160, 0, 255, 42, 185, 119, 26, 192, 65, 3, 1, 61, 178, 49, 192, 143, 49, 66, 160, 0, 255, 135, 128, 180, 4, 0, 0, 0, 0, 135, 24, 234, 31, 192, 65, 0, 187, 108, 187, 168, 224, 175, 27, 3, 160, 1, 255, 73, 136, 108, 177, 224, 65, 10, 165, 133, 110, 72, 224, 143, 38, 67, 160, 1, 255, 69, 0, 12, 0, 153, 36, 145, 228, 224, 97, 7, 186, 221, 91, 163, 224, 175, 29, 4, 161, 1, 255, 103, 47, 57, 162, 224, 65, 12, 144, 32, 13, 161, 224, 143, 24, 68, 161, 1, 255, 28, 253, 97, 246, 224, 97, 9, 189, 240, 227, 68, 224, 175, 47, 16, 161, 1, 255, 1, 0, 0, 0, 229, 238, 114, 194, 224, 65, 14, 188, 65, 3, 79, 224, 143, 42, 80, 161, 1, 255, 26, 0, 0, 0, 9, 186, 61, 105, 224, 97, 11, 145, 145, 237, 170], [224, 175, 33, 17, 161, 1, 255, 6, 8, 0, 0, 232, 92, 222, 85, 224, 65, 0, 187, 108, 187, 168, 224, 143, 28, 81, 161, 1, 255, 113, 252, 38, 100, 224, 97, 13, 164, 52, 142, 67], [224, 143, 46, 6, 161, 1, 255, 154, 0, 0, 0, 127, 167, 193, 74, 224, 97, 15, 136, 85, 128, 173], [224, 139, 0, 127, 83, 174, 153, 224, 97, 1, 143, 120, 56, 74, 224, 163, 3, 111, 172, 250, 93, 224, 65, 2, 151, 13, 181, 70, 224, 134, 2, 30, 76, 14, 194, 224, 97, 3, 163, 25, 54, 164], [224, 138, 4, 39, 166, 216, 135, 224, 97, 5, 150, 188, 85, 77, 224, 163, 5, 90, 9, 153, 180, 224, 65, 4, 162, 168, 214, 175], [224, 166, 6, 165, 172, 231, 80, 224, 65, 6, 142, 201, 216, 65], [224, 134, 7, 145, 184, 100, 178, 224, 97, 6, 44, 237, 92, 212, 192, 141, 0, 249, 244, 244, 207, 192, 65, 1, 45, 92, 188, 223, 192, 131, 1, 225, 233, 112, 38, 192, 65, 0, 187, 108, 187, 168], [192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 65, 3, 1, 61, 178, 49, 192, 143, 83, 65, 160, 0, 255, 34, 5, 96, 28, 67, 9, 0, 0, 144, 1, 23, 10, 67, 38, 10, 17, 237, 141, 151, 206, 192, 65, 2, 151, 13, 181, 70], [224, 129, 81, 44, 145, 1, 46, 44, 209, 2, 0, 44, 193, 3, 0, 44, 177, 4, 0, 244, 65, 6, 0, 42, 247, 108, 228, 224, 97, 0, 25, 72, 63, 61, 224, 162, 16, 244, 209, 135, 82, 103, 102, 30, 241, 224, 65, 1, 45, 92, 188, 223, 224, 131, 3, 205, 136, 126, 200, 224, 97, 2, 53, 41, 49, 211], [224, 134, 5, 189, 217, 106, 92, 224, 97, 4, 0, 140, 82, 58, 224, 168, 2, 50, 69, 9, 201, 224, 65, 3, 1, 61, 178, 49, 224, 132, 23, 44, 145, 1, 46, 48, 66, 219, 53, 224, 97, 6, 44, 237, 92, 212, 224, 171, 4, 196, 179, 71, 11, 224, 65, 5, 52, 152, 209, 216, 224, 131, 9, 211, 97, 171, 40, 224, 97, 8, 43, 192, 228, 51, 224, 166, 6, 165, 172, 231, 80, 224, 65, 7, 24, 249, 223, 54], [224, 143, 43, 6, 161, 1, 255, 154, 1, 0, 0, 7, 136, 148, 1, 224, 97, 10, 7, 161, 234, 221, 224, 143, 45, 6, 161, 1, 255, 154, 1, 0, 0, 141, 241, 142, 114, 224, 97, 12, 50, 4, 137, 52, 224, 143, 47, 6, 161, 1, 255, 154, 1, 0, 0, 11, 217, 120, 92, 224, 97, 14, 30, 101, 135, 218, 224, 143, 33, 6, 161, 1, 255, 154, 1, 0, 0, 153, 2, 186, 148, 224, 97, 0, 25, 72, 63, 61, 224, 143, 35, 6, 161, 1, 255, 154, 1, 0, 0, 31, 42, 76, 186, 224, 97, 2, 53, 41, 49, 211], [224, 143, 37, 6, 161, 1, 255, 154, 1, 0, 0, 149, 83, 86, 201, 224, 97, 4, 0, 140, 82, 58, 224, 143, 39, 6, 161, 1, 255, 154, 1, 0, 0, 19, 123, 160, 231, 224, 97, 6, 44, 237, 92, 212, 224, 143, 41, 6, 161, 1, 255, 154, 1, 0, 0, 129, 160, 98, 47, 224, 97, 8, 43, 192, 228, 51, 224, 143, 43, 6, 161, 1, 255, 154, 1, 0, 0, 7, 136, 148, 1, 224, 97, 10, 7, 161, 234, 221], [224, 143, 45, 6, 161, 1, 255, 154, 1, 0, 0, 141, 241, 142, 114, 224, 97, 12, 50, 4, 137, 52], [224, 143, 47, 6, 161, 1, 255, 154, 1, 0, 0, 11, 217, 120, 92, 224, 97, 14, 30, 101, 135, 218], [224, 143, 33, 6, 161, 1, 255, 154, 1, 0, 0, 153, 2, 186, 148, 224, 97, 0, 25, 72, 63, 61, 224, 143, 35, 6, 161, 1, 255, 154, 1, 0, 0, 31, 42, 76, 186, 224, 97, 2, 53, 41, 49, 211, 224, 143, 37, 6, 161, 1, 255, 154, 1, 0, 0, 149, 83, 86, 201, 224, 97, 4, 0, 140, 82, 58, 224, 143, 39, 6, 161, 1, 255, 154]]
# framework hdmi card
packets6 = [[192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [224, 161, 17, 44, 145, 1, 39, 177, 155, 38, 148, 224, 1, 0, 190, 35, 194, 88, 224, 130, 16, 68, 16, 129, 18, 170, 55, 43, 91, 224, 97, 1, 143, 120, 56, 74, 224, 163, 3, 111, 172, 250, 93, 224, 1, 2, 146, 66, 204, 182], [224, 166, 5, 31, 253, 238, 201, 224, 1, 4, 167, 231, 175, 95], [192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253], [192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66], [192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56], [192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183], [192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205], [192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114], [192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253], [192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66, 192, 143, 24, 1, 160, 0, 255, 101, 14, 114, 66], [192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56, 192, 143, 26, 1, 160, 0, 255, 5, 93, 178, 56], [192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183, 192, 143, 28, 1, 160, 0, 255, 165, 168, 242, 183], [192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205, 192, 143, 30, 1, 160, 0, 255, 197, 251, 50, 205], [192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114, 192, 143, 16, 1, 160, 0, 255, 164, 69, 2, 114], [192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8, 192, 143, 18, 1, 160, 0, 255, 196, 22, 194, 8], [192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135, 192, 143, 20, 1, 160, 0, 255, 100, 227, 130, 135], [192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253, 192, 143, 22, 1, 160, 0, 255, 4, 176, 66, 253], [224, 175, 23, 1, 160, 0, 255, 130, 156, 142, 199, 224, 1, 6, 139, 134, 161, 177, 224, 143, 82, 65, 160, 0, 255, 172, 50, 0, 108, 0, 0, 0, 0, 0, 0, 2, 0, 24, 0, 0, 0, 138, 93, 194, 80, 224, 97, 3, 163, 25, 54, 164, 224, 175, 25, 2, 160, 0, 255, 13, 141, 11, 106, 224, 1, 8, 140, 171, 25, 86, 224, 143, 36, 66, 160, 0, 255, 0, 0, 1, 255, 235, 230, 247, 249, 224, 97, 5, 150, 188, 85, 77, 224, 175, 27, 3, 160, 1, 255, 73, 136, 108, 177, 224, 1, 10, 160, 202, 23, 184, 224, 143, 38, 67, 160, 1, 255, 5, 4, 0, 0, 116, 155, 57, 212, 224, 97, 7, 186, 221, 91, 163, 224, 175, 29, 4, 161, 1, 255, 103, 47, 57, 162, 224, 1, 12, 149, 111, 116, 81, 224, 143, 24, 68, 161, 1, 255, 28, 253, 97, 246, 224, 175, 47, 16, 161, 1, 255, 1, 0, 0, 0, 229, 238, 114, 194, 224, 1, 14, 185, 14, 122, 191, 224, 175, 33, 17, 161, 1, 255, 6, 4, 0, 0, 140, 165, 196, 92, 224, 1, 0, 190, 35, 194, 88, 224, 143, 28, 81, 161, 1, 255, 113, 252, 38, 100, 224, 97, 13, 164, 52, 142, 67]]

packets_pos = [ 0,0 ] # hoot-hoot,,, hewwo ;-P

def gb():
    fun = postfactum_readout if replay else fusb.get_rxb
    return stacc.show_msg(stacc.get_message(fun))

def gba():
    # not quite working well atm, sowwy (also, mood)
    while True:
      try:
        gb(); print()
      except IndexError:
        return
      except Exception as e:
        raise e
        break

def postfactum_readout(length=80):
    # A function that helps read data out of our own capture buffer instead of using the FUSB's internal buffer
    # so, it pretends to be the FUSB FIFO read function, for parsing packets that are recorded into `packets`
    err = 0
    response = []
    while len(response) < length:
        # ran out of data? this ends here
        if packets_pos[0] == len(packets)-1 and packets_pos[1] == len(packets[packets_pos[0]])-1:
            # buffer underflow, returning the unfinished buffer with zeroes in the end, just like the FUSB does
            response = [0]*(length-len(response))
            return bytes(response)
        # we still got data to add!
        # is the current buffer enough?
        remainder = length - len(response)
        current_packet = packets[packets_pos[0]]
        current_packet_end = current_packet[packets_pos[1]:]
        while remainder > 0:
            chunk_len = min(len(current_packet_end), remainder)
            response += current_packet_end[:chunk_len]
            remainder -= chunk_len
            packets_pos[1] += chunk_len
            # now, checking for overflow
            if packets_pos[1] >= len(current_packet)-1:
                # sanity check - this should not happen
                if packets_pos[1] > len(current_packet):
                    print("Alert, overcount!", packets_pos, len(current_packet_end), chunk_len)
                # do we need to go to the next packet?
                if len(packets)-1 <= packets_pos[0]:
                    # next packet doesn't exist lol
                    print("We ran out of packet")
                    err += 1 # malformed packets cause this function to glitch and loop infinitely, hence the error counter
                    if err == 4:
                        return bytes(response) # lol gave up here
                else:
                    err = 0
                    packets_pos[0] += 1
                    packets_pos[1] = 0
            current_packet = packets[packets_pos[0]]
            current_packet_end = current_packet[packets_pos[1]:]
        return bytes(response)

########################
#
# it gets real here
#
########################

listen_cc = 2

stacc.init_fusb()
stacc.setup_listen(listen_cc)

if not replay:
    stacc.flow_record(packets=packets)
else:
    packets = packets1; gba()
